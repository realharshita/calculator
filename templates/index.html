<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calculator</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="header">
        <h1>Scientific Calculator</h1>
    </div>
    <div class="calculator">
        <div class="display">
            <div id="currentCalculation" class="small-display"></div>
            <input type="text" id="display" disabled>
        </div>
        <div class="buttons">
            <button onclick="appendNumber(7)">7</button>
            <button onclick="appendNumber(8)">8</button>
            <button onclick="appendNumber(9)">9</button>
            <button class="operation" onclick="setOperation('divide')">/</button>
            <button class="operation" onclick="setOperation('sqrt')">√</button>
        </div>
        <div class="buttons">
            <button onclick="appendNumber(4)">4</button>
            <button onclick="appendNumber(5)">5</button>
            <button onclick="appendNumber(6)">6</button>
            <button class="operation" onclick="setOperation('multiply')">*</button>
            <button class="operation" onclick="setOperation('pow')">x<sup>y</sup></button>
        </div>
        <div class="buttons">
            <button onclick="appendNumber(1)">1</button>
            <button onclick="appendNumber(2)">2</button>
            <button onclick="appendNumber(3)">3</button>
            <button class="operation" onclick="setOperation('subtract')">-</button>
            <button class="operation" onclick="setOperation('log')">log<sub>2</sub></button>
        </div>
        <div class="buttons">
            <button onclick="appendNumber(0)">0</button>
            <button onclick="clearDisplay()">C</button>
            <button class="operation" onclick="setOperation('add')">+</button>
            <button class="operation" onclick="setOperation('exp')">2<sup>x</sup></button>
        </div>
        <div class="buttons">
            <button class="equals" onclick="calculate()">=</button>
        </div>
        <div class="buttons">
            <button class="operation" onclick="setOperation('sin')">sin</button>
            <button class="operation" onclick="setOperation('cos')">cos</button>
            <button class="operation" onclick="setOperation('tan')">tan</button>
            <button class="operation" onclick="setOperation('factorial')">x!</button>
            <button class="operation" onclick="setOperation('mod')">%</button>
        </div>
        <div class="buttons">
            <button class="operation" onclick="storeMemory()">MS</button>
            <button class="operation" onclick="recallMemory()">MR</button>
        </div>
    </div>

    <script>
        let num1 = '';
        let num2 = '';
        let operation = '';
        let memory = '';

        function appendNumber(number) {
            if (operation === '') {
                num1 += number;
                document.getElementById('display').value = num1;
            } else {
                num2 += number;
                document.getElementById('display').value = num2;
            }
            updateCurrentCalculation();
        }

        function setOperation(op) {
            if (num1 !== '') {
                operation = op;
                document.getElementById('display').value = '';
                updateCurrentCalculation();
            }
        }

        function clearDisplay() {
            num1 = '';
            num2 = '';
            operation = '';
            document.getElementById('display').value = '';
            document.getElementById('currentCalculation').innerHTML = '';
        }

        function storeMemory() {
            if (num1 !== '') {
                memory = num1;
                alert('Value stored in memory.');
            }
        }

        function recallMemory() {
            if (memory !== '') {
                if (operation === '') {
                    num1 = memory;
                    document.getElementById('display').value = num1;
                } else {
                    num2 = memory;
                    document.getElementById('display').value = num2;
                }
                updateCurrentCalculation();
            }
        }

        function calculate() {
            if (num1 !== '' && (operation !== '' && num2 !== '' || ['sin', 'cos', 'tan', 'sqrt', 'log', 'exp', 'factorial'].includes(operation))) {
                let formData = new FormData();
                formData.append('num1', num1);
                formData.append('operation', operation);
                if (num2 !== '') {
                    formData.append('num2', num2);
                }

                fetch('/calculate', {
                    method: 'POST',
                    body: formData
                })
                .then(response => response.json())
                .then(data => {
                    document.getElementById('display').value = data.result;
                    document.getElementById('currentCalculation').innerHTML = '';
                    num1 = '';
                    num2 = '';
                    operation = '';
                })
                .catch(error => console.error('Error:', error));
            }
        }

        function updateCurrentCalculation() {
            let currentCalculation = num1 + ' ' + (operation !== '' ? getOperationSymbol(operation) : '') + ' ' + num2;
            document.getElementById('currentCalculation').innerHTML = currentCalculation;
        }

        function getOperationSymbol(op) {
            const symbols = {
                'add': '+',
                'subtract': '-',
                'multiply': '*',
                'divide': '/',
                'sqrt': '√',
                'pow': '^',
                'log': 'log₂',
                'exp': '2^',
                'sin': 'sin',
                'cos': 'cos',
                'tan': 'tan',
                'factorial': '!',
                'mod': '%'
            };
            return symbols[op] || '';
        }
    </script>
</body>
</html>
